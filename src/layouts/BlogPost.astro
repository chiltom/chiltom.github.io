---
import { Image } from 'astro:assets';
import type { CollectionEntry } from 'astro:content';
import BaseHead from '../components/BaseHead.astro';
import Footer from '../components/Footer.astro';
import FormattedDate from '../components/FormattedDate.astro';
import Header from '../components/Header.astro';
import ReadingProgress from '../components/ReadingProgress';
import TableOfContents from '../components/TableOfContents';

type Props = CollectionEntry<'blog'>['data'] & {
	headings?: { depth: number; slug: string; text: string }[];
};

const { title, description, pubDate, updatedDate, heroImage, headings = [] } = Astro.props;
---

<html lang="en">
	<head>
		<BaseHead title={title} description={description} />
	</head>

	<body class="min-h-screen flex flex-col bg-white dark:bg-gray-950">
		<Header />

		<!-- Reading Progress Bar -->
		<ReadingProgress client:load />

		<div class="flex-1">
			<div class="max-w-6xl mx-auto px-6 py-12">
				<!-- Hero Image -->
				{heroImage && (
					<div class="mb-12 rounded-2xl overflow-hidden shadow-xl">
						<Image
							width={1200}
							height={600}
							src={heroImage}
							alt={title}
							class="w-full h-auto object-cover"
						/>
					</div>
				)}

				<div class="grid grid-cols-1 lg:grid-cols-[1fr_250px] gap-12">
					<!-- Main Content -->
					<article class="min-w-0">
						<!-- Article Header -->
						<header class="mb-12">
							<div class="mb-4 text-gray-600 dark:text-gray-400">
								<FormattedDate date={pubDate} />
								{updatedDate && (
									<span class="italic ml-2">
										(Updated: <FormattedDate date={updatedDate} />)
									</span>
								)}
							</div>
							<h1 class="text-4xl md:text-5xl font-bold mb-4 tracking-tight bg-gradient-to-r from-blue-600 to-indigo-600 dark:from-blue-400 dark:to-indigo-400 bg-clip-text text-transparent">
								{title}
							</h1>
							<p class="text-xl text-gray-600 dark:text-gray-400 leading-relaxed">
								{description}
							</p>
							<hr class="mt-8 border-gray-200 dark:border-gray-700" />
						</header>

						<!-- Table of Contents (Mobile) -->
						{headings.length > 0 && (
							<TableOfContents headings={headings} client:visible />
						)}

						<!-- Article Content -->
						<div class="prose prose-lg max-w-none">
							<slot />
						</div>

						<!-- Back Navigation -->
						<div class="mt-16 pt-8 border-t border-gray-200 dark:border-gray-700">
							<a
								href="/blog"
								class="inline-flex items-center text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-500 font-medium group"
							>
								<svg class="w-5 h-5 mr-2 transform group-hover:-translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
								</svg>
								Back to all posts
							</a>
						</div>
					</article>

					<!-- Table of Contents Sidebar (Desktop) -->
					{headings.length > 0 && (
						<aside class="hidden lg:block">
							<TableOfContents headings={headings} client:visible />
						</aside>
					)}
				</div>
			</div>
		</div>

		<Footer />
	</body>
</html>
